---
phase: 18-mode-transition-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/(dashboard)/page.tsx
  - components/layout/Sidebar.tsx
  - components/layout/MobileNav.tsx
  - public/sw.js
autonomous: true

must_haves:
  truths:
    - "Clicking Planner mode card on dashboard navigates to /cop (COP Reader)"
    - "Dashboard 'Browse all' and 'Browse Details' links point to /cop"
    - "Desktop sidebar shows 'COP Reader' with BookOpen icon linking to /cop"
    - "Mobile slide-out menu shows 'COP Reader' linking to /cop"
    - "Fixer mode card, sidebar link, and mobile nav link remain unchanged (/fixer)"
    - "Service worker version is v3, triggering cache refresh on next visit"
  artifacts:
    - path: "app/(dashboard)/page.tsx"
      provides: "Dashboard with Planner card linking to /cop, browse links updated"
      contains: 'href="/cop"'
    - path: "components/layout/Sidebar.tsx"
      provides: "Desktop sidebar with COP Reader nav item"
      contains: "COP Reader"
    - path: "components/layout/MobileNav.tsx"
      provides: "Mobile menu with COP Reader nav item"
      contains: "COP Reader"
    - path: "public/sw.js"
      provides: "Service worker v3"
      contains: "CACHE_VERSION = 'v3'"
  key_links:
    - from: "app/(dashboard)/page.tsx"
      to: "/cop"
      via: "Link href on Planner mode card"
      pattern: 'href="/cop"'
    - from: "components/layout/Sidebar.tsx"
      to: "/cop"
      via: "mainNavItems href"
      pattern: "href: '/cop'"
    - from: "components/layout/MobileNav.tsx"
      to: "/cop"
      via: "mainNavItems href in MobileSidebarContent"
      pattern: "href: '/cop'"
---

<objective>
Update all primary navigation surfaces to point Planner mode at /cop (COP Reader) instead of /planner, and bump the service worker cache version to v3.

Purpose: This is the core mode transition -- making COP Reader the primary Planner navigation path while preserving all existing routes for backward compatibility. No routes are removed, no mode logic changes.
Output: Updated dashboard, sidebar, mobile nav, and service worker.
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\LukeBoustridge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-mode-transition-polish/18-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update navigation links from /planner to /cop</name>
  <files>
    app/(dashboard)/page.tsx
    components/layout/Sidebar.tsx
    components/layout/MobileNav.tsx
  </files>
  <action>
    **Dashboard page.tsx** (4 link changes + 1 icon + 1 description):
    - Line 103: Change `<Link href="/planner">` to `<Link href="/cop">` (Planner mode card)
    - Line 5: Add `BookOpen` to the lucide-react import (alongside existing Clipboard)
    - Line 113: Change `<Clipboard className="h-6 w-6 text-primary" />` to `<BookOpen className="h-6 w-6 text-primary" />`
    - Line 117: Change `<CardDescription>Office & Desktop Planning</CardDescription>` to `<CardDescription>Browse COP by Chapter</CardDescription>`
    - Line 123-125: Change description text to "Browse the Code of Practice by chapter. Read sections, view technical diagrams, and access supplementary guides."
    - Line 127: Change badges to `<Badge variant="secondary">19 Chapters</Badge>` `<Badge variant="secondary">Technical Diagrams</Badge>` `<Badge variant="secondary">HTG Guides</Badge>`
    - Line 287: Change `href="/planner"` to `href="/cop"` ("Browse all" link in Recently Viewed header)
    - Line 330: Change `<Link href="/planner">` to `<Link href="/cop">` ("Browse Details" empty-state button in Recently Viewed)
    - Line 400: Change `<Link href="/planner">` to `<Link href="/cop">` ("Browse Details" empty-state button in Favourites)
    - DO NOT change the individual detail deep-links on lines 305 and 366 (`/planner/${detail.substrateId}/...`) -- those are substrate-navigation deep links that must remain.
    - DO NOT change the Fixer mode card (lines 135-165) -- it stays as `/fixer`.

    **Sidebar.tsx** (2 changes):
    - Line 10: Add `BookOpen` to the lucide-react import, remove `Clipboard` (no longer used in this file)
    - Line 24: Change `{ href: '/planner', label: 'Planner', icon: Clipboard }` to `{ href: '/cop', label: 'COP Reader', icon: BookOpen }`
    - Line 46: Update the isActive check for main nav items to support path prefix matching for /cop routes. Change `const isActive = pathname === item.href;` to `const isActive = item.href === '/' ? pathname === '/' : pathname === item.href || pathname.startsWith(item.href + '/');` -- This ensures the COP Reader nav item highlights when browsing /cop/1, /cop/8, etc. The Home item uses exact match to avoid always being active.
    - DO NOT change the Fixer item (`/fixer`) or any other nav items.

    **MobileNav.tsx** (2 changes):
    - Line 5: Add `BookOpen` to the lucide-react import (keep Clipboard for the mode indicator at bottom of sheet)
    - Line 86: Change `{ href: '/planner', label: 'Planner Mode', icon: Clipboard, highlight: mode === 'planner' }` to `{ href: '/cop', label: 'COP Reader', icon: BookOpen, highlight: mode === 'planner' }`
    - DO NOT change the Fixer Mode item (line 87) or the mode indicator section at the bottom (lines 168-185) -- those correctly reference the mode state.
    - DO NOT change the bottom navigation bar items (lines 18-23) -- COP Reader is accessed via the slide-out sheet, not the bottom bar.
  </action>
  <verify>
    Run `npx next build` to verify no TypeScript errors.
    Grep the modified files to confirm:
    - `grep -n 'href="/planner"' app/(dashboard)/page.tsx` returns ONLY the detail deep-links (lines ~305 and ~366), NOT the mode card or browse links
    - `grep -n 'href="/planner"' components/layout/Sidebar.tsx` returns no results
    - `grep -n 'href="/planner"' components/layout/MobileNav.tsx` returns no results
    - `grep 'BookOpen' components/layout/Sidebar.tsx` returns the import line
    - `grep "COP Reader" components/layout/Sidebar.tsx` returns the nav item
    - `grep "COP Reader" components/layout/MobileNav.tsx` returns the nav item
  </verify>
  <done>
    Planner mode card on dashboard links to /cop with BookOpen icon and updated description. "Browse all" and "Browse Details" links point to /cop. Sidebar shows "COP Reader" with BookOpen icon. Mobile sheet menu shows "COP Reader". All Fixer links unchanged. Detail deep-links preserved.
  </done>
</task>

<task type="auto">
  <name>Task 2: Bump service worker cache version to v3</name>
  <files>public/sw.js</files>
  <action>
    - Line 2: Change `const CACHE_VERSION = 'v2';` to `const CACHE_VERSION = 'v3';`
    - No other changes to sw.js. The STATIC_ASSETS array already includes '/cop' (line 17) and '/planner' (line 11), so both routes will continue to be cached.
    - The version bump ensures browsers clear old v2 caches (which have stale navigation HTML pointing to /planner) and re-cache with updated HTML pointing to /cop.
    - skipWaiting() (line 42) and clients.claim() (line 71) are already present, ensuring the new SW activates immediately.
  </action>
  <verify>
    `grep "CACHE_VERSION" public/sw.js` should show `const CACHE_VERSION = 'v3';`
    `grep "'/cop'" public/sw.js` should confirm /cop is still in STATIC_ASSETS
    `grep "'/planner'" public/sw.js` should confirm /planner is still in STATIC_ASSETS (backward compat)
  </verify>
  <done>
    Service worker cache version is v3. Old v2 caches will be cleaned up on next activation. Both /cop and /planner remain in STATIC_ASSETS for caching.
  </done>
</task>

</tasks>

<verification>
1. `npx next build` completes without errors
2. No remaining `href="/planner"` in Sidebar.tsx or MobileNav.tsx
3. Dashboard page.tsx has `href="/cop"` for mode card and browse links, but retains `/planner/...` for detail deep-links
4. sw.js has CACHE_VERSION = 'v3'
5. All /fixer links unchanged across all files
</verification>

<success_criteria>
- Planner mode card navigates to /cop (COP Reader) with BookOpen icon
- Desktop sidebar shows "COP Reader" linking to /cop with active state on /cop/* paths
- Mobile slide-out menu shows "COP Reader" linking to /cop
- Dashboard browse/empty-state links point to /cop
- Fixer mode completely unchanged
- Service worker version bumped to v3
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/18-mode-transition-polish/18-01-SUMMARY.md`
</output>
