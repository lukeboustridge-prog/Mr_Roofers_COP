---
phase: 14-basic-cop-reader
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - types/cop.ts
  - app/(dashboard)/cop/page.tsx
  - app/(dashboard)/cop/loading.tsx
  - app/(dashboard)/cop/[chapterNumber]/page.tsx
  - app/(dashboard)/cop/[chapterNumber]/loading.tsx
autonomous: true

must_haves:
  truths:
    - "User can open /cop and see a grid of all 19 COP chapters with their titles and chapter numbers"
    - "User can tap a chapter card and navigate to /cop/{N} which loads that chapter's content"
    - "COP version identifier is displayed prominently at the top of the /cop page"
    - "Loading skeletons appear while chapter data loads"
    - "Chapter cards show section count and chapter number badge"
  artifacts:
    - path: "types/cop.ts"
      provides: "TypeScript interfaces for COP chapter JSON structure"
      contains: "CopChapter"
    - path: "app/(dashboard)/cop/page.tsx"
      provides: "COP chapter grid index page"
      exports: ["default"]
      min_lines: 40
    - path: "app/(dashboard)/cop/loading.tsx"
      provides: "Loading skeleton for chapter grid"
      exports: ["default"]
    - path: "app/(dashboard)/cop/[chapterNumber]/page.tsx"
      provides: "Chapter reader page shell (content renderer added in Plan 02)"
      exports: ["default"]
      min_lines: 30
    - path: "app/(dashboard)/cop/[chapterNumber]/loading.tsx"
      provides: "Loading skeleton for chapter reader"
      exports: ["default"]
  key_links:
    - from: "app/(dashboard)/cop/page.tsx"
      to: "public/cop/chapter-{N}.json"
      via: "fs.readFileSync in Server Component"
      pattern: "readFileSync.*chapter-"
    - from: "app/(dashboard)/cop/page.tsx"
      to: "/cop/{chapterNumber}"
      via: "Next.js Link component"
      pattern: "href=.*\\/cop\\/"
    - from: "app/(dashboard)/cop/[chapterNumber]/page.tsx"
      to: "public/cop/chapter-{N}.json"
      via: "fs.readFileSync in Server Component"
      pattern: "readFileSync.*chapter-"
    - from: "types/cop.ts"
      to: "app/(dashboard)/cop/page.tsx"
      via: "import type"
      pattern: "from.*types/cop"
---

<objective>
Create the COP Reader route structure: chapter grid index page at /cop with all 19 chapters displayed as tappable cards, chapter reader page shell at /cop/[chapterNumber], TypeScript types for the chapter JSON structure, and loading skeletons for both routes.

Purpose: Establishes the route structure and navigation for the COP Reader. Users get a visual chapter listing matching the printed PDF structure, with clear version identification and one-tap access to any chapter.

Output: Four route files (2 pages + 2 loading skeletons) and a shared types file. The chapter reader page will contain a basic content display that Plan 02 enhances with recursive section rendering and inline images.
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\LukeBoustridge\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@C:\Users\LukeBoustridge\Projects\RANZ\Master Roofers Code of Practice\.planning\ROADMAP.md
@C:\Users\LukeBoustridge\Projects\RANZ\Master Roofers Code of Practice\.planning\STATE.md
@C:\Users\LukeBoustridge\Projects\RANZ\Master Roofers Code of Practice\.planning\phases\14-basic-cop-reader\14-RESEARCH.md
@C:\Users\LukeBoustridge\Projects\RANZ\Master Roofers Code of Practice\.planning\phases\13-data-foundation\13-02-SUMMARY.md

Key codebase files to reference for patterns:
@C:\Users\LukeBoustridge\Projects\RANZ\Master Roofers Code of Practice\app\(dashboard)\planner\page.tsx
@C:\Users\LukeBoustridge\Projects\RANZ\Master Roofers Code of Practice\app\(dashboard)\planner\loading.tsx
@C:\Users\LukeBoustridge\Projects\RANZ\Master Roofers Code of Practice\app\(dashboard)\loading.tsx
@C:\Users\LukeBoustridge\Projects\RANZ\Master Roofers Code of Practice\app\(dashboard)\layout.tsx
@C:\Users\LukeBoustridge\Projects\RANZ\Master Roofers Code of Practice\types\index.ts
@C:\Users\LukeBoustridge\Projects\RANZ\Master Roofers Code of Practice\next.config.mjs
</context>

<tasks>

<task type="auto">
  <name>Task 1: COP TypeScript types and chapter grid index page</name>
  <files>
    types/cop.ts
    app/(dashboard)/cop/page.tsx
    app/(dashboard)/cop/loading.tsx
  </files>
  <action>
**Step 1: Create types/cop.ts**

Define TypeScript interfaces matching the actual chapter JSON structure (verified from public/cop/chapter-1.json and chapter-8.json). The interfaces must be:

```typescript
// types/cop.ts

export interface CopImageDimensions {
  width: number;
  height: number;
}

export interface CopImage {
  filename: string;
  url: string;          // Full R2 URL (e.g. "https://pub-xxx.r2.dev/images/mrm/...")
  caption: string;
  dimensions: CopImageDimensions;
}

export interface CopSection {
  number: string;       // e.g. "8", "8.1", "8.1.1", "8.3A"
  title: string;
  level: number;        // 1 = chapter heading, 2 = section, 3 = subsection, etc.
  content: string;      // Plain text with \n line breaks
  pdfPages: number[];
  images?: CopImage[];
  subsections?: CopSection[];
}

export interface CopChapter {
  chapterNumber: number;
  title: string;
  version: string;      // e.g. "v25.12"
  sectionCount: number;
  sections: CopSection[];
}

// Lightweight metadata for the grid (avoids loading full content)
export interface CopChapterMeta {
  chapterNumber: number;
  title: string;
  version: string;
  sectionCount: number;
}
```

**Step 2: Create app/(dashboard)/cop/page.tsx**

Server Component that displays all 19 chapters as a card grid. Follow the pattern from `app/(dashboard)/planner/page.tsx` exactly for layout, Card usage, and responsive grid.

Key implementation details:
- Import `fs` and `path` (Node.js built-ins, safe in Server Components)
- Read chapter JSON files using `fs.readFileSync(path.join(process.cwd(), 'public', 'cop', 'chapter-${i}.json'))` for chapters 1-19
- Parse ONLY the metadata fields (chapterNumber, title, version, sectionCount) -- do NOT store the full sections array in memory for the grid page
- Display version prominently: extract version from first chapter (all are "v25.12"), display as "v25.12 -- 1 December 2025" in a subtitle/badge below the page title. This satisfies COPR-06.
- Use the same grid layout as planner: `grid gap-4 sm:grid-cols-2 lg:grid-cols-3`
- Each card is a `<Link href={/cop/${chapter.chapterNumber}}>` wrapping a Card
- Card structure: Badge with "Chapter {N}", CardTitle with chapter title, CardDescription with "{N} sections"
- Use `h-full cursor-pointer transition-all hover:shadow-lg hover:border-primary/50` on Card (matches planner pattern)
- Add a Lucide `BookOpen` icon (from lucide-react) in a colored box matching the planner icon pattern
- Touch targets are already >= 48px via Card size + padding
- Container: `container max-w-6xl p-4 md:p-6 lg:p-8`

Do NOT use `'use client'` -- this is a Server Component.
Do NOT use dynamic imports for JSON -- use fs.readFileSync (simpler, more reliable for public/ files).

**Step 3: Create app/(dashboard)/cop/loading.tsx**

Loading skeleton matching the grid layout. Follow the pattern from `app/(dashboard)/planner/loading.tsx`:
- Same container width and padding
- Skeleton for page title and subtitle (including version line)
- 6 skeleton cards in the same grid layout (sm:grid-cols-2 lg:grid-cols-3)
- Each skeleton card: badge placeholder, title placeholder, description placeholder
- Use Skeleton and Card from shadcn/ui components
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compilation succeeds with the new types and page files. Verify the cop directory structure exists with: `ls app/(dashboard)/cop/` showing page.tsx and loading.tsx.
  </verify>
  <done>
- types/cop.ts exports CopChapter, CopSection, CopImage, CopChapterMeta interfaces
- /cop page displays all 19 chapters in a responsive card grid with chapter numbers, titles, and section counts
- Version "v25.12 -- 1 December 2025" is displayed prominently below the page heading
- Loading skeleton shows while page data loads
- Each card links to /cop/{chapterNumber}
- TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Chapter reader page shell with loading skeleton</name>
  <files>
    app/(dashboard)/cop/[chapterNumber]/page.tsx
    app/(dashboard)/cop/[chapterNumber]/loading.tsx
  </files>
  <action>
**Step 1: Create app/(dashboard)/cop/[chapterNumber]/page.tsx**

Server Component that loads a single chapter's JSON and renders a basic content shell. Plan 02 will enhance this with proper recursive section rendering and inline images, but this page must be functional on its own.

Key implementation details:
- Import `fs` and `path` for reading chapter JSON
- Import types from `@/types/cop`
- Accept `params: Promise<{ chapterNumber: string }>` (Next.js 14 App Router convention -- params is a Promise, use `await params` to resolve)
- Validate chapterNumber is 1-19 integer. If invalid, call `notFound()` from `next/navigation`
- Check if file exists before reading. If not found, call `notFound()`
- Read chapter JSON with `fs.readFileSync` and parse with `JSON.parse` typed as `CopChapter`
- Page layout:
  - Container: `container max-w-4xl p-4 md:p-6 lg:p-8` (narrower than grid -- reader content)
  - Back link: A small "Back to COP" link at top using `<Link href="/cop">` with a Lucide `ArrowLeft` icon. Style: `text-sm text-slate-500 hover:text-slate-700 flex items-center gap-1 mb-4`
  - Chapter heading: `<h1>` with "Chapter {N}: {title}" in `text-2xl font-bold text-slate-900 md:text-3xl`
  - Version badge: Badge showing version string (e.g. "v25.12") below heading
  - Section count: Subtle text like "{N} sections" in `text-sm text-slate-500`
  - Content area: A `<div>` with id="chapter-content" that contains basic content rendering. For now, iterate over `chapter.sections` (top-level only) and render each section's number+title as an `<h2>` followed by content in `whitespace-pre-line text-slate-700 leading-relaxed`. Plan 02 will replace this with the full recursive SectionRenderer component with inline images.

Do NOT use `'use client'` -- Server Component.
Do NOT import the entire chapter into client-side JS -- fs.readFileSync ensures it stays server-side.

**Step 2: Create app/(dashboard)/cop/[chapterNumber]/loading.tsx**

Loading skeleton for the chapter reader page:
- Same narrower container (`max-w-4xl`)
- Skeleton for back link area
- Skeleton for chapter title (wide, tall)
- Skeleton for version badge
- 4-5 skeleton content blocks representing sections (each: heading skeleton + 3-4 lines of text skeleton at varying widths)
- Use Skeleton component from shadcn/ui
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compilation. Then start the dev server with `npx next dev` and verify:
1. Navigate to /cop -- 19 chapter cards appear with titles, section counts, and version display
2. Click Chapter 1 card -- navigates to /cop/1 showing chapter content
3. Navigate to /cop/99 -- shows 404 not-found page
4. Back link on chapter page returns to /cop grid
  </verify>
  <done>
- /cop/[chapterNumber] route loads chapter JSON and renders chapter heading, version badge, and basic section content
- Invalid chapter numbers (0, 20, "abc") return 404 via notFound()
- Loading skeleton displays while chapter data loads
- Back navigation link returns to /cop grid
- Content displays with preserved line breaks (whitespace-pre-line)
- TypeScript compiles without errors
- Dev server renders both routes without runtime errors
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes -- no TypeScript errors
2. `npx next dev` starts without build errors
3. /cop route shows 19 chapter cards in responsive grid with version "v25.12 -- 1 December 2025"
4. Each card links to /cop/{N} and loads the correct chapter
5. /cop/{N} shows chapter title, version, and section content with preserved line breaks
6. /cop/0 and /cop/20 return 404
7. Loading skeletons display when navigating between routes
8. All routes are protected by Clerk auth (inherited from (dashboard) layout)
</verification>

<success_criteria>
- COP Reader route structure is complete at /cop and /cop/[chapterNumber]
- All 19 chapters accessible via card grid with one-tap navigation
- Version identifier "v25.12 -- 1 December 2025" displayed prominently (COPR-06)
- TypeScript types accurately model the chapter JSON structure
- Loading states provide visual feedback
- Basic content rendering works (enhanced by Plan 02)
</success_criteria>

<output>
After completion, create `.planning/phases/14-basic-cop-reader/14-01-SUMMARY.md`
</output>
