---
phase: 12-content-linking-population
plan: 04
type: execute
wave: 3
depends_on: ["12-01", "12-02"]
files_modified:
  - .planning/phases/12-content-linking-population/12-AUDIT.md
autonomous: false

must_haves:
  truths:
    - "Admin has reviewed and approved/rejected all suggestions"
    - "Link population audit report generated"
    - "All exact matches have been processed"
    - "System has appropriate MRM-RANZ links"
  artifacts:
    - path: ".planning/phases/12-content-linking-population/12-AUDIT.md"
      provides: "Link population audit report"
      min_lines: 30
  key_links: []
---

<objective>
Verify admin link management workflow, approve suggestions, and generate population audit report.

Purpose: Ensure the link management system works end-to-end and document the final state of MRM-RANZ content links.

Output:
- All exact match suggestions approved
- Link population audit report (12-AUDIT.md)
- Verified admin workflow
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\LukeBoustridge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-content-linking-population/12-01-SUMMARY.md
@.planning/phases/12-content-linking-population/12-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate pre-population audit data</name>
  <files>
    - (console output)
  </files>
  <action>
Before admin review, collect baseline metrics:

1. Run the suggestion script to count potential links:
   ```bash
   npx tsx scripts/suggest-detail-links.ts --dry-run 2>&1 | tee suggestion-output.txt
   ```

2. Query current link counts:
   ```typescript
   // Run via tsx script or db client
   const totalMrm = await db.select({ count: count() }).from(details).where(eq(details.sourceId, 'mrm-cop'));
   const totalRanz = await db.select({ count: count() }).from(details).where(eq(details.sourceId, 'ranz-guide'));
   const existingLinks = await db.select({ count: count() }).from(detailLinks);
   ```

3. Document in console output:
   - Total MRM details
   - Total RANZ details
   - Total RANZ details with 3D models
   - Current link count
   - Suggested exact matches
   - Suggested partial matches
   - Suggested related matches

This provides baseline for before/after comparison in audit.
  </action>
  <verify>
Console output shows baseline metrics for audit
  </verify>
  <done>
Pre-population metrics documented
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Admin link management UI with suggestion review workflow:
- /admin/links - View and delete existing links
- /admin/links/suggestions - Review and approve/reject suggestions
- Bulk "Approve All Exact" functionality
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`

2. Navigate to admin links page:
   - URL: http://localhost:3000/admin/links
   - Verify existing test links display in table
   - Verify delete button works (test on one link, confirm removal)

3. Navigate to suggestions page:
   - Click "Review Suggestions" button
   - URL: http://localhost:3000/admin/links/suggestions
   - Verify suggestions are grouped by confidence (Exact, Partial, Related)
   - Verify LinkPreview shows source badges

4. Test approve flow:
   - Click "Approve" on one suggestion
   - Verify card is removed from list
   - Go back to /admin/links
   - Verify new link appears in table

5. Test bulk approve (if exact matches exist):
   - Click "Approve All Exact" button
   - Confirm dialog
   - Verify all exact matches are processed
   - Verify links appear in main table

6. Review partial and related matches:
   - Approve those that make semantic sense
   - Reject those that don't match conceptually
   - (Code similarity != semantic equivalence)

Document final counts for audit report.
  </how-to-verify>
  <resume-signal>Type "approved" with final link count, or describe issues</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Generate link population audit report</name>
  <files>
    - .planning/phases/12-content-linking-population/12-AUDIT.md
  </files>
  <action>
After admin review, create audit report at `.planning/phases/12-content-linking-population/12-AUDIT.md`:

```markdown
# Content Linking Population Audit

**Date:** [YYYY-MM-DD]
**Auditor:** Claude (automated) + [User] (manual review)

## Summary

| Metric | Count |
|--------|-------|
| Total MRM Details | [X] |
| Total RANZ Details | [X] |
| RANZ Details with 3D Models | [X] |
| **Links Created** | **[X]** |

## Link Breakdown

| Confidence | Suggested | Approved | Rejected |
|------------|-----------|----------|----------|
| Exact | [X] | [X] | [X] |
| Partial | [X] | [X] | [X] |
| Related | [X] | [X] | [X] |
| **Total** | **[X]** | **[X]** | **[X]** |

## Coverage Analysis

- MRM details with linked RANZ content: [X] / [Total MRM] ([%])
- RANZ details linked to MRM: [X] / [Total RANZ] ([%])

## Unlinked Content

### MRM Details Without RANZ Links
Details that could benefit from RANZ 3D models/installation guides but no suitable match exists:
- [List top 5 unlinked MRM codes if applicable]

### RANZ Details Not Linked to MRM
RANZ guides that aren't supplementing any MRM detail:
- [List count or note if all linked]

## Verification Results

- [x] Suggestion script generates accurate matches
- [x] Admin can approve/reject suggestions
- [x] Approved links appear in admin table
- [x] Linked content displays correctly on detail pages
- [x] E2E tests pass for all content scenarios

## Recommendations

1. **[If low coverage]:** Consider expanding link criteria or manual linking for specific substrates
2. **[If high rejection rate]:** Review suggestion algorithm - may need name-based secondary matching
3. **[If all good]:** Link population complete, ready for production

## Sign-off

- [ ] All exact matches reviewed and processed
- [ ] Partial matches reviewed for semantic relevance
- [ ] E2E tests verified
- [ ] Phase 12 complete
```

Fill in actual numbers from Task 1 baseline and checkpoint results.
  </action>
  <verify>
12-AUDIT.md exists with complete metrics and sign-off checklist
  </verify>
  <done>
- Audit report created with final metrics
- Coverage analysis documented
- Recommendations provided
- Sign-off checklist included
  </done>
</task>

</tasks>

<verification>
1. Review 12-AUDIT.md for completeness
2. Verify all metrics are filled in (no placeholders)
3. Confirm E2E tests pass: `npx playwright test tests/content-scenarios.spec.ts`
4. Verify sample linked details display correctly in UI
</verification>

<success_criteria>
- [ ] Admin workflow verified manually
- [ ] All exact matches processed (approved or rejected)
- [ ] 12-AUDIT.md created with complete metrics
- [ ] Coverage analysis shows meaningful linking
- [ ] Sign-off checklist completed
</success_criteria>

<output>
After completion, create `.planning/phases/12-content-linking-population/12-04-SUMMARY.md`
</output>
