---
phase: 08-visual-authority-system
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - components/authority/SourceBadge.tsx
  - components/details/DetailCard.tsx
autonomous: true

must_haves:
  truths:
    - "SourceBadge displays blue styling for authoritative (MRM) content"
    - "SourceBadge displays grey styling for supplementary (RANZ) content"
    - "DetailCard shows source badge indicating content authority"
    - "DetailCard shows capability badges for 3D model, steps, warnings, case law"
    - "DetailCard uses authority-aware hover styling"
  artifacts:
    - path: "components/authority/SourceBadge.tsx"
      provides: "Extended SourceBadge with authority variants"
      exports: ["SourceBadge", "SourceAttribution"]
    - path: "components/details/DetailCard.tsx"
      provides: "Enhanced card with source and capability badges"
  key_links:
    - from: "components/details/DetailCard.tsx"
      to: "components/authority/SourceBadge.tsx"
      via: "imports and renders SourceBadge"
      pattern: "import.*SourceBadge.*from.*authority"
    - from: "components/details/DetailCard.tsx"
      to: "components/authority/ContentCapabilityBadges.tsx"
      via: "imports and renders ContentCapabilityBadges"
      pattern: "import.*ContentCapabilityBadges.*from.*authority"
    - from: "components/details/DetailCard.tsx"
      to: "lib/constants.ts"
      via: "imports and uses getAuthorityLevel"
      pattern: "import.*getAuthorityLevel.*from.*constants"
---

<objective>
Extend SourceBadge with authority-aware variants and update DetailCard to display source attribution and content capability badges.

Purpose: Users can identify content authority (MRM vs RANZ) and available capabilities (3D, steps, warnings, case law) at a glance from detail listings without opening each detail.

Output: Enhanced SourceBadge component with blue/grey authority variants, and updated DetailCard with source badge and capability badges.
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\LukeBoustridge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-visual-authority-system/08-RESEARCH.md
@.planning/phases/08-visual-authority-system/08-01-SUMMARY.md

# Source files
@components/details/SourceBadge.tsx
@components/details/DetailCard.tsx
@lib/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create extended SourceBadge with authority variants</name>
  <files>
    components/authority/SourceBadge.tsx
  </files>
  <action>
Create a new SourceBadge in components/authority/ that extends the existing pattern with class-variance-authority (cva) for authority-aware styling:

1. Import cva from 'class-variance-authority' and VariantProps type
2. Import Library (supplementary icon) and BookOpen (authoritative icon) from lucide-react
3. Import cn from '@/lib/utils'

4. Define sourceBadgeVariants using cva:
   ```typescript
   const sourceBadgeVariants = cva(
     'inline-flex items-center rounded-md border px-2 py-0.5 text-xs font-semibold',
     {
       variants: {
         authority: {
           authoritative: 'bg-primary/10 border-primary/30 text-primary',
           supplementary: 'bg-slate-100 border-slate-200 text-slate-600',
         },
         size: {
           sm: 'text-xs px-1.5 py-0',
           md: 'text-sm px-2 py-0.5',
         },
       },
       defaultVariants: {
         authority: 'supplementary',
         size: 'sm',
       },
     }
   );
   ```

5. Define SourceBadgeProps interface extending VariantProps:
   ```typescript
   interface SourceBadgeProps extends VariantProps<typeof sourceBadgeVariants> {
     shortName: string;
     name?: string;
     showIcon?: boolean;
     className?: string;
   }
   ```

6. Implement SourceBadge component:
   - Use BookOpen icon for authoritative, Library icon for supplementary
   - Icon size: h-3 w-3 with mr-1 spacing
   - Apply variants via cn(sourceBadgeVariants({ authority, size }), className)
   - Include title attribute for full name on hover

7. Also implement SourceAttribution component (similar to existing):
   - Accept authority prop in addition to existing props
   - Use appropriate icon based on authority level
   - Display source name with appropriate text color

8. Update components/authority/index.ts barrel export to include SourceBadge and SourceAttribution

Note: This creates a NEW SourceBadge in authority/, not modifying the existing one in details/. The existing one will be deprecated and consumers migrated later.
  </action>
  <verify>
    - File exists at components/authority/SourceBadge.tsx
    - Exports SourceBadge and SourceAttribution components
    - SourceBadge renders blue styling when authority="authoritative"
    - SourceBadge renders grey styling when authority="supplementary"
    - components/authority/index.ts updated with new exports

    Run: npm run build (should compile without TypeScript errors)
  </verify>
  <done>
    Extended SourceBadge exists in components/authority/ with cva-powered authority variants. Authoritative content shows blue styling with BookOpen icon. Supplementary content shows grey styling with Library icon.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update DetailCard with source and capability badges</name>
  <files>
    components/details/DetailCard.tsx
  </files>
  <action>
Enhance DetailCard to display source attribution and content capabilities:

1. Add new props to DetailCardProps interface:
   ```typescript
   interface DetailCardProps {
     code: string;
     name: string;
     substrate: string;
     sourceId?: string | null;
     sourceShortName?: string;
     has3DModel?: boolean;
     hasSteps?: boolean;
     hasWarning?: boolean;       // Keep for backward compatibility
     warningCount?: number;
     failureCount?: number;
     href: string;
   }
   ```

2. Import from new locations:
   ```typescript
   import { SourceBadge, ContentCapabilityBadges } from '@/components/authority';
   import { getAuthorityLevel } from '@/lib/constants';
   ```

3. At component start, calculate authority:
   ```typescript
   const authority = getAuthorityLevel(sourceId);
   ```

4. Update Card styling to be authority-aware:
   - For authoritative: hover:border-primary/50
   - For supplementary: hover:border-slate-300

5. Update the left icon container:
   - For authoritative: bg-primary/10 with text-primary icon
   - For supplementary: bg-slate-100 with text-slate-600 icon

6. Add SourceBadge before the code Badge:
   ```tsx
   {sourceShortName && (
     <SourceBadge
       shortName={sourceShortName}
       authority={authority}
       size="sm"
     />
   )}
   ```

7. Replace the existing warning/failure badges section with ContentCapabilityBadges:
   ```tsx
   <div className="flex items-center gap-2">
     <ContentCapabilityBadges
       capabilities={{
         has3DModel: has3DModel ?? false,
         hasSteps: hasSteps ?? false,
         hasWarnings: (warningCount ?? 0) > 0 || hasWarning === true,
         hasCaseLaw: (failureCount ?? 0) > 0,
       }}
     />
   </div>
   ```

8. Remove the old warning Badge and failure Badge JSX (replaced by ContentCapabilityBadges)

9. Ensure backward compatibility: keep hasWarning prop working alongside warningCount
  </action>
  <verify>
    - File updated at components/details/DetailCard.tsx
    - DetailCard accepts new props: sourceId, sourceShortName, has3DModel, hasSteps
    - DetailCard renders SourceBadge with authority styling
    - DetailCard renders ContentCapabilityBadges with correct capabilities
    - Authority-aware hover styling works

    Run: npm run build (should compile without TypeScript errors)
  </verify>
  <done>
    DetailCard displays source attribution with authority-aware styling and capability badges. Users can see at a glance whether content is authoritative (blue) or supplementary (grey) and what content is available (3D, steps, warnings, case law).
  </done>
</task>

</tasks>

<verification>
1. Run `npm run build` - should complete without TypeScript errors
2. Check SourceBadge renders correctly:
   - authority="authoritative" -> blue background, BookOpen icon
   - authority="supplementary" -> grey background, Library icon
3. Check DetailCard renders:
   - SourceBadge with correct authority styling when sourceShortName provided
   - ContentCapabilityBadges with correct icons for available capabilities
   - Authority-aware hover border color
</verification>

<success_criteria>
- [ ] components/authority/SourceBadge.tsx exists with cva variants
- [ ] SourceBadge renders blue styling for MRM COP content
- [ ] SourceBadge renders grey styling for RANZ content
- [ ] DetailCard accepts sourceId, sourceShortName, has3DModel, hasSteps props
- [ ] DetailCard displays SourceBadge when source info provided
- [ ] DetailCard displays ContentCapabilityBadges for content capabilities
- [ ] npm run build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-visual-authority-system/08-02-SUMMARY.md`
</output>
