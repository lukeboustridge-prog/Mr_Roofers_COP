---
phase: 08-visual-authority-system
plan: 03
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - components/details/DetailViewer.tsx
autonomous: false

must_haves:
  truths:
    - "MRM COP content sections display blue authoritative styling"
    - "RANZ Guide content sections display grey supplementary styling"
    - "Version watermark 'MRM COP v25.12' visible on authoritative content"
    - "Every content block (specs, steps, warnings) shows source attribution"
    - "Warnings section NOT wrapped in authority styling (has own severity colors)"
  artifacts:
    - path: "components/details/DetailViewer.tsx"
      provides: "Enhanced detail page with authority visual treatment"
  key_links:
    - from: "components/details/DetailViewer.tsx"
      to: "components/authority/AuthoritativeContent.tsx"
      via: "wraps MRM content sections"
      pattern: "AuthoritativeContent.*showWatermark"
    - from: "components/details/DetailViewer.tsx"
      to: "components/authority/SupplementaryContent.tsx"
      via: "wraps RANZ content sections"
      pattern: "SupplementaryContent"
    - from: "components/details/DetailViewer.tsx"
      to: "lib/constants.ts"
      via: "imports getAuthorityLevel for authority detection"
      pattern: "getAuthorityLevel"
---

<objective>
Integrate authority wrapper components into DetailViewer to provide visual distinction for content sections based on their source (MRM COP vs RANZ Guide).

Purpose: Users viewing a detail page can immediately identify which sections come from authoritative (MRM COP) vs supplementary (RANZ) sources through consistent blue/grey visual treatment.

Output: Updated DetailViewer.tsx that wraps content sections with AuthoritativeContent or SupplementaryContent based on the detail's sourceId.
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\LukeBoustridge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-visual-authority-system/08-RESEARCH.md
@.planning/phases/08-visual-authority-system/08-01-SUMMARY.md

# Source file
@components/details/DetailViewer.tsx
@lib/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add authority imports and detection to DetailViewer</name>
  <files>
    components/details/DetailViewer.tsx
  </files>
  <action>
Add authority system imports and detection at the top of DetailViewer.tsx:

1. Add new imports near the top of the file:
   ```typescript
   import {
     AuthoritativeContent,
     SupplementaryContent,
     VersionWatermark,
   } from '@/components/authority';
   import { getAuthorityLevel } from '@/lib/constants';
   ```

2. Inside the DetailViewer component, after existing state declarations, add:
   ```typescript
   // Determine content authority for visual styling
   const authority = getAuthorityLevel(detail.sourceId);
   const isAuthoritative = authority === 'authoritative';
   ```

3. Create a helper component inside DetailViewer (or as a local function) for wrapping content:
   ```typescript
   const ContentWrapper = ({ children, showWatermark = false }: { children: React.ReactNode; showWatermark?: boolean }) => {
     if (isAuthoritative) {
       return (
         <AuthoritativeContent showWatermark={showWatermark}>
           {children}
         </AuthoritativeContent>
       );
     }
     return (
       <SupplementaryContent>
         {children}
       </SupplementaryContent>
     );
   };
   ```

This sets up the foundation for wrapping content sections with appropriate authority styling.
  </action>
  <verify>
    - DetailViewer.tsx imports AuthoritativeContent, SupplementaryContent from @/components/authority
    - DetailViewer.tsx imports getAuthorityLevel from @/lib/constants
    - authority variable is calculated from detail.sourceId
    - ContentWrapper helper exists for conditional wrapping

    Run: npm run build (should compile without TypeScript errors)
  </verify>
  <done>
    DetailViewer imports authority components and calculates authority level from detail.sourceId. ContentWrapper helper enables conditional authority styling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wrap content sections with authority styling</name>
  <files>
    components/details/DetailViewer.tsx
  </files>
  <action>
Wrap appropriate content sections with authority wrappers:

1. **Header section** - Add subtle authority indicator:
   Update the header section (around line 283-305) to include authority-aware styling on the detail code badge area. Don't wrap the entire header, just update the SourceBadge import:
   ```typescript
   // Replace existing SourceBadge import
   import { SourceBadge } from '@/components/authority';
   ```
   And update SourceBadge usage in header:
   ```tsx
   {detail.source && (
     <SourceBadge
       shortName={detail.source.shortName}
       name={detail.source.name}
       authority={authority}
       size="md"
       showIcon
     />
   )}
   ```

2. **Overview Tab - Specifications section** (around line 451-469):
   Wrap the specifications Card with ContentWrapper:
   ```tsx
   {detail.specifications && Object.keys(detail.specifications).length > 0 && (
     <ContentWrapper showWatermark={isAuthoritative}>
       <Card>
         <CardHeader>
           <CardTitle className="text-lg">Specifications</CardTitle>
         </CardHeader>
         {/* ... existing content ... */}
       </Card>
     </ContentWrapper>
   )}
   ```

3. **Installation Tab - Steps section** (around line 501-507):
   Wrap StepByStep with ContentWrapper:
   ```tsx
   <TabsContent value="installation" className="mt-6">
     <ContentWrapper>
       <StepByStep
         steps={steps}
         activeStep={hasStepSync ? activeStep : undefined}
         onStepChange={hasStepSync ? handleStepChange : undefined}
       />
     </ContentWrapper>
   </TabsContent>
   ```

4. **Warnings Tab** - DO NOT wrap with authority styling:
   Warnings have their own severity colors (amber for warning, red for critical). Wrapping them in blue/grey would conflict. Leave the warnings section unchanged.

5. **References Tab - Source Attribution section** (around line 546-560):
   Keep existing SourceAttribution but update import:
   ```typescript
   import { SourceBadge, SourceAttribution } from '@/components/authority';
   ```
   Update SourceAttribution to use authority prop if needed, or keep as-is since it already displays source info.

6. **Case Law section** (around line 471-484):
   DO NOT wrap with authority styling - case law has its own red styling for emphasis.

Important: Be careful not to double-nest wrappers. Only wrap the outermost container of each content section.
  </action>
  <verify>
    - Specifications section wrapped with ContentWrapper + watermark on authoritative content
    - Installation steps section wrapped with ContentWrapper
    - Warnings section NOT wrapped (maintains severity colors)
    - Case Law section NOT wrapped (maintains red emphasis)
    - SourceBadge in header uses authority prop
    - No TypeScript errors

    Run: npm run build (should compile without TypeScript errors)
  </verify>
  <done>
    Content sections display authority-aware visual styling. MRM COP content shows blue border-left with version watermark. RANZ content shows grey border-left. Warnings and case law maintain their severity-based styling unchanged.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Visual authority system integration in DetailViewer - MRM COP content styled with blue authoritative treatment, RANZ content styled with grey supplementary treatment, version watermark displayed on authoritative content.</what-built>
  <how-to-verify>
    1. Start the dev server: `npm run dev`
    2. Navigate to a detail page with MRM source (e.g., any detail from the MRM COP section)
    3. Verify:
       - SourceBadge in header shows blue styling for MRM
       - Specifications section has blue border-left
       - "MRM COP v25.12" watermark visible in top-right of specifications
       - Installation steps have blue border-left
       - Warnings section maintains amber/red styling (no blue)
    4. Navigate to a RANZ detail (if available) and verify:
       - SourceBadge shows grey styling
       - Content sections have grey border-left
       - No version watermark on supplementary content
    5. Verify styling doesn't conflict or cause layout issues
    6. Check responsive behavior on mobile viewport
  </how-to-verify>
  <resume-signal>Type "approved" if visual authority styling displays correctly, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
1. Run `npm run build` - should complete without TypeScript errors
2. Run `npm run dev` and test:
   - MRM detail shows blue authority styling on relevant sections
   - RANZ detail shows grey supplementary styling
   - Version watermark displays only on authoritative content
   - Warnings maintain severity colors (not wrapped with authority)
   - Layout works on desktop and mobile
3. Verify no console errors or warnings
</verification>

<success_criteria>
- [ ] DetailViewer imports authority components correctly
- [ ] Authority level calculated from detail.sourceId
- [ ] Specifications section wrapped with authority styling
- [ ] Installation steps section wrapped with authority styling
- [ ] Warnings section NOT wrapped (maintains severity colors)
- [ ] Version watermark shows on authoritative content only
- [ ] SourceBadge in header uses authority variant
- [ ] Visual verification confirms correct styling
- [ ] npm run build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-visual-authority-system/08-03-SUMMARY.md`
</output>
