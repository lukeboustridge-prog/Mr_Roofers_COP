---
phase: 11-search-enhancement
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - components/search/ConsentModeToggle.tsx
autonomous: true

must_haves:
  truths:
    - "User can toggle consent mode on and off"
    - "Toggle state persists in URL as consentMode parameter"
    - "Toggle displays clear visual indication of active state"
  artifacts:
    - path: "components/search/ConsentModeToggle.tsx"
      provides: "Consent mode toggle with URL state sync"
      exports: ["ConsentModeToggle"]
  key_links:
    - from: "components/search/ConsentModeToggle.tsx"
      to: "URL searchParams"
      via: "useSearchParams hook"
      pattern: "useSearchParams"
---

<objective>
Create ConsentModeToggle component for filtering search to authoritative MRM content only.

Purpose: Allow users to enable "Building Code Citation Mode" which hides supplementary content and shows only MRM COP authoritative content suitable for Building Consent documentation (SEARCH-03 requirement).

Output: Reusable toggle component with URL state persistence, authority-aware styling, and tooltip explanation.
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\LukeBoustridge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-search-enhancement/11-RESEARCH.md

@components/navigation/SourceFilterTabs.tsx
@components/authority/SourceBadge.tsx
@lib/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ConsentModeToggle component</name>
  <files>
    components/search/ConsentModeToggle.tsx
  </files>
  <action>
Create `components/search/ConsentModeToggle.tsx`:

```typescript
'use client';

import { useRouter, useSearchParams, usePathname } from 'next/navigation';
import { Switch } from '@/components/ui/switch';
import { Label } from '@/components/ui/label';
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from '@/components/ui/tooltip';
import { BookOpen, HelpCircle } from 'lucide-react';
import { cn } from '@/lib/utils';

interface ConsentModeToggleProps {
  className?: string;
}

/**
 * Consent mode toggle for filtering search results to authoritative content only.
 * When enabled, shows only MRM COP content suitable for Building Consent documentation.
 * Persists state in URL as consentMode parameter for shareable links.
 */
export function ConsentModeToggle({ className }: ConsentModeToggleProps) {
  const router = useRouter();
  const pathname = usePathname();
  const searchParams = useSearchParams();
  const consentMode = searchParams.get('consentMode') === 'true';

  const handleToggle = (checked: boolean) => {
    const params = new URLSearchParams(searchParams.toString());
    if (checked) {
      params.set('consentMode', 'true');
      // Also filter to MRM source when consent mode enabled
      params.set('source', 'mrm-cop');
    } else {
      params.delete('consentMode');
      // Restore to all sources when consent mode disabled
      params.delete('source');
    }
    const queryString = params.toString();
    router.replace(`${pathname}${queryString ? `?${queryString}` : ''}`, { scroll: false });
  };

  return (
    <div className={cn('flex items-center gap-3', className)}>
      <div className="flex items-center gap-2">
        <Switch
          id="consent-mode"
          checked={consentMode}
          onCheckedChange={handleToggle}
          aria-describedby="consent-mode-description"
          className={cn(
            consentMode && 'data-[state=checked]:bg-primary'
          )}
        />
        <Label
          htmlFor="consent-mode"
          className={cn(
            'flex items-center gap-2 cursor-pointer text-sm font-medium transition-colors',
            consentMode ? 'text-primary' : 'text-slate-700'
          )}
        >
          <BookOpen className={cn('h-4 w-4', consentMode && 'text-primary')} />
          Building Code Citation Mode
        </Label>
      </div>
      <TooltipProvider>
        <Tooltip>
          <TooltipTrigger asChild>
            <button
              type="button"
              className="text-slate-400 hover:text-slate-600"
              aria-label="What is Building Code Citation Mode?"
            >
              <HelpCircle className="h-4 w-4" />
            </button>
          </TooltipTrigger>
          <TooltipContent side="bottom" className="max-w-xs">
            <p id="consent-mode-description" className="text-sm">
              When enabled, shows only MRM Code of Practice content suitable for
              Building Consent documentation and official citations.
              Supplementary content from other sources is hidden.
            </p>
          </TooltipContent>
        </Tooltip>
      </TooltipProvider>
    </div>
  );
}
```

This component:
- Uses Switch from shadcn/ui for accessible toggle
- Persists state in URL as `consentMode=true` parameter
- Also sets `source=mrm-cop` when enabled for API filtering
- Shows BookOpen icon to match MRM authoritative visual system
- Includes tooltip explaining what consent mode does
- Uses primary color styling when active to indicate authoritative filtering
- Works with existing URL state patterns from SourceFilterTabs
  </action>
  <verify>
Run TypeScript compilation:
```bash
npx tsc --noEmit components/search/ConsentModeToggle.tsx
```
Should compile without errors.

Visual verification (after integration in Plan 03):
1. Visit /search
2. Toggle should appear
3. Clicking toggle should add ?consentMode=true to URL
4. Toggling off should remove parameter
  </verify>
  <done>
ConsentModeToggle component created with URL state sync, authority-aware styling, and tooltip explanation. Exports ConsentModeToggle for use in search page.
  </done>
</task>

</tasks>

<verification>
1. Component file exists at components/search/ConsentModeToggle.tsx
2. TypeScript compiles without errors
3. Component exports ConsentModeToggle function
4. Uses useSearchParams, useRouter, usePathname for URL state
5. Includes Switch, Label, Tooltip from shadcn/ui
6. Has accessible aria-describedby linking tooltip to switch
</verification>

<success_criteria>
- ConsentModeToggle component created and exports correctly
- Uses URL searchParams for state persistence (consentMode parameter)
- Includes tooltip explaining Building Code Citation Mode
- Uses primary color styling when active (matches authority visual system)
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/11-search-enhancement/11-02-SUMMARY.md`
</output>
