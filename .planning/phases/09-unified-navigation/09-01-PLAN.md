---
phase: 09-unified-navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/(dashboard)/topics/page.tsx
  - app/(dashboard)/topics/[topicId]/page.tsx
  - app/(dashboard)/topics/[topicId]/topic-client.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to /topics and see a list of available topics"
    - "User can click a topic and see details from all sources in a unified listing"
    - "User can see source badges on each detail card indicating MRM COP or RANZ Guide"
  artifacts:
    - path: "app/(dashboard)/topics/page.tsx"
      provides: "Topics listing page server component"
      min_lines: 30
    - path: "app/(dashboard)/topics/[topicId]/page.tsx"
      provides: "Topic details page server component with searchParams"
      min_lines: 40
    - path: "app/(dashboard)/topics/[topicId]/topic-client.tsx"
      provides: "Client component for interactive topic browsing"
      min_lines: 60
  key_links:
    - from: "app/(dashboard)/topics/[topicId]/page.tsx"
      to: "lib/db/queries/topics.ts"
      via: "getDetailsByTopic query"
      pattern: "getDetailsByTopic"
    - from: "app/(dashboard)/topics/[topicId]/topic-client.tsx"
      to: "components/details/DetailCard.tsx"
      via: "DetailCard component import"
      pattern: "import.*DetailCard"
---

<objective>
Create the topic-based navigation infrastructure for unified content browsing.

Purpose: Enable users to browse semantic topics (e.g., "Flashings") and see content from all sources (MRM COP + RANZ Guide) in a single listing, laying the foundation for the unified navigation system.

Output: Topic listing page and topic detail page with DetailCard integration showing source badges.
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\LukeBoustridge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-unified-navigation/09-RESEARCH.md

# Phase 8 established authority patterns
@components/authority/SourceBadge.tsx
@components/authority/ContentCapabilityBadges.tsx
@components/details/DetailCard.tsx

# Existing query functions from Phase 7
@lib/db/queries/topics.ts

# Existing pattern to follow
@app/(dashboard)/planner/[substrate]/[category]/category-client.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Topics Listing Page</name>
  <files>app/(dashboard)/topics/page.tsx</files>
  <action>
Create a server component at `app/(dashboard)/topics/page.tsx` that displays all available topics.

Implementation:
1. Import `getTopicsWithCounts` from `@/lib/db/queries/topics`
2. Fetch all topics with their category and detail counts
3. Render a grid of topic cards (similar to substrate selector pattern)
4. Each topic card should show:
   - Topic name (large, clickable)
   - Topic description (if available)
   - Detail count badge (e.g., "45 details")
   - Category count (e.g., "Across 3 categories")
5. Link each card to `/topics/{topicId}`
6. Include Breadcrumbs component at top: Home > Topics
7. Add page metadata (title: "Browse Topics | Master Roofers COP")

Use existing Card component from shadcn/ui. Style similar to planner substrate cards with proper touch targets (min 48px).

If no topics exist, show empty state message directing to planner view.
  </action>
  <verify>
Run `npm run build` - no errors.
Navigate to http://localhost:3000/topics - page renders with topic cards.
Each topic card links to /topics/{topicId}.
  </verify>
  <done>
Topics listing page exists at /topics, shows all available topics with detail counts, and links to individual topic pages.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Topic Detail Page with Client Component</name>
  <files>
app/(dashboard)/topics/[topicId]/page.tsx
app/(dashboard)/topics/[topicId]/topic-client.tsx
  </files>
  <action>
Create the topic detail page as server + client component split.

**Server Component (page.tsx):**

```typescript
interface TopicPageProps {
  params: Promise<{ topicId: string }>;
  searchParams: Promise<{ source?: string; capabilities?: string }>;
}
```

1. Await params and searchParams (Next.js 15 async params pattern)
2. Fetch topic by ID using `getTopicById`
3. Fetch details using `getDetailsByTopic` with sourceId filter from searchParams
4. If topic not found, call `notFound()`
5. Pass data to TopicDetailsClient component
6. Include Breadcrumbs: Home > Topics > {topic.name}
7. Add page metadata with topic name

**Client Component (topic-client.tsx):**

1. Accept props: topic, details, initialSourceFilter
2. Use DetailCard component to render each detail (already has source badges from Phase 8)
3. Map details to DetailCard props:
   - code, name
   - substrate (from category or topic name)
   - sourceId, sourceShortName (from query join)
   - has3DModel (modelUrl !== null)
   - hasSteps (derive from detail or default false for now)
   - warningCount, failureCount (default 0 for now - will be enhanced later)
   - href: `/topics/${topicId}/${detail.id}` or `/planner/...` existing route

4. Handle empty state when no details match filters
5. Show results count: "{n} details from all sources" or "{n} details from {source}"

Use existing patterns from category-client.tsx for layout and empty states.

Note: Filter UI (tabs, checkboxes) will be added in Plan 02. This task establishes the page structure and data flow.
  </action>
  <verify>
Run `npm run build` - no errors.
Navigate to http://localhost:3000/topics/{topicId} - page renders with details.
Each detail shows SourceBadge with MRM or RANZ styling.
Details are clickable and navigate correctly.
  </verify>
  <done>
Topic detail page exists at /topics/[topicId], displays unified details from all sources, and shows source badges on each card.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds with no errors
2. /topics page shows all topics with counts
3. /topics/{topicId} shows details from both MRM and RANZ sources
4. SourceBadge displays correctly (blue for MRM, grey for RANZ)
5. Empty state shows when topic has no details
6. Breadcrumbs show correct hierarchy
</verification>

<success_criteria>
- User can navigate to /topics and see list of all topics
- User can click a topic and see details from all sources unified
- Each detail card shows source attribution (MRM COP or RANZ Guide)
- Pages build without errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-unified-navigation/09-01-SUMMARY.md`
</output>
