---
phase: 34-installation-guide-transformation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - components/details/DetailViewer.tsx
  - components/details/CopSectionLinks.tsx
  - components/cop/SupplementaryDetailCard.tsx
autonomous: true

must_haves:
  truths:
    - "'View in COP' banner link navigates to /encyclopedia/cop/ route instead of /cop/"
    - "COP section link pills on detail pages navigate to /encyclopedia/cop/ route"
    - "SupplementaryDetailCard in COP articles shows step count and warning count indicators"
    - "SupplementaryDetailCard links to /fixer/ detail pages for bidirectional navigation"
  artifacts:
    - path: "components/details/DetailViewer.tsx"
      provides: "Updated COP banner link target"
      contains: "/encyclopedia/cop/"
    - path: "components/details/CopSectionLinks.tsx"
      provides: "Updated COP section link targets"
      contains: "/encyclopedia/cop/"
    - path: "components/cop/SupplementaryDetailCard.tsx"
      provides: "Enhanced preview card with step/warning counts"
      contains: "stepCount"
  key_links:
    - from: "components/details/DetailViewer.tsx"
      to: "/encyclopedia/cop/"
      via: "View in COP banner Link href"
      pattern: "encyclopedia/cop"
    - from: "components/details/CopSectionLinks.tsx"
      to: "/encyclopedia/cop/"
      via: "section link Link href"
      pattern: "encyclopedia/cop"
    - from: "components/cop/SupplementaryDetailCard.tsx"
      to: "/fixer/"
      via: "card Link href"
      pattern: "fixer.*detail.id"
---

<objective>
Update COP cross-links to use encyclopedia routes and enhance Installation Guide detail preview cards in COP articles.

Purpose: INSTALL-03 requires detail pages to link to the encyclopedia COP routes (not old /cop/ routes) for cross-reference. INSTALL-04 requires COP articles to show richer preview cards for linked installation details, helping users decide whether to navigate to a detail.
Output: All COP links from detail pages point to /encyclopedia/cop/ routes. SupplementaryDetailCard shows enhanced preview with step count and warning count indicators.
</objective>

<execution_context>
@C:/Users/LukeBoustridge/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/LukeBoustridge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@components/details/DetailViewer.tsx
@components/details/CopSectionLinks.tsx
@components/cop/SupplementaryDetailCard.tsx
@types/cop.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update COP cross-links to encyclopedia routes</name>
  <files>
    components/details/DetailViewer.tsx
    components/details/CopSectionLinks.tsx
  </files>
  <action>
    Update all links from Installation Guide detail pages to COP sections to use the new encyclopedia routes:

    1. **DetailViewer.tsx** — "View in COP" banner (around line 576):
       - Change href from `/cop/${copSectionLinks[0].chapterNumber}#section-${copSectionLinks[0].sectionNumber}`
       - To: `/encyclopedia/cop/${copSectionLinks[0].chapterNumber}#section-${copSectionLinks[0].sectionNumber}`
       - Also update the banner text: "View full reference in COP Reader" -> "View in COP Encyclopedia"
       - And subtitle: "For detailed specifications, standards references, and context" -> "Full article with cross-references, practical guidance, and case law"

    2. **CopSectionLinks.tsx** — Section link pills (line 44):
       - Change href from `/cop/${section.chapterNumber}#section-${section.sectionNumber}`
       - To: `/encyclopedia/cop/${section.chapterNumber}#section-${section.sectionNumber}`
       - Update the heading text (line 31): "COP Sections" -> "COP Encyclopedia Sections"
       - Update description (line 38): "View this detail in context within the Code of Practice." -> "View this detail in context within the COP Encyclopedia articles."

    These are simple string replacements. Route structure is /encyclopedia/cop/[chapter]#section-[number].
  </action>
  <verify>Run `npm run build` to confirm no compilation errors. Grep: `grep -rn '"/cop/' components/details/` should return zero matches (all links now use /encyclopedia/cop/).</verify>
  <done>All COP section links from detail pages point to /encyclopedia/cop/ routes with updated label text.</done>
</task>

<task type="auto">
  <name>Task 2: Enhance SupplementaryDetailCard with preview indicators</name>
  <files>
    components/cop/SupplementaryDetailCard.tsx
    types/cop.ts
  </files>
  <action>
    Enhance the SupplementaryDetailCard displayed in COP encyclopedia articles to show richer installation guide previews:

    1. **types/cop.ts** — Extend the SupplementaryDetail interface:
       - Add optional fields: `stepCount?: number`, `warningCount?: number`, `hasChecklist?: boolean`
       - These are populated from the junction query in the article composition pipeline

    2. **SupplementaryDetailCard.tsx** — Add preview indicators:
       - After the existing 3D badge (line 36-39), add:
         - Step count badge: If `detail.stepCount && detail.stepCount > 0`, show a badge with Wrench icon and `"{stepCount} steps"` text (use Wrench from lucide-react)
         - Warning count badge: If `detail.warningCount && detail.warningCount > 0`, show a badge with AlertTriangle icon and count, using amber color scheme (`bg-amber-100 text-amber-700`)
       - Add import for `Wrench, AlertTriangle` from lucide-react (Wrench might need adding, AlertTriangle might need adding)
       - Update the "Supplementary" label under the source badge to say "Installation Guide" instead

    3. **SupplementaryDetailCard.tsx** — Keep the link target as `/fixer/${detail.id}` (route stays /fixer until Phase 35 migration).

    Note: The step/warning count data availability depends on the article composition query. The fields are OPTIONAL — the card renders gracefully without them (existing behavior). The data will already be available from the `cop_section_details` junction with a simple join, but we're not changing the query in this plan — just making the UI ready to display the counts when available.
  </action>
  <verify>Run `npm run build` to confirm no TypeScript errors with the extended interface. Verify the card component renders without errors by checking the build output for any component-level issues.</verify>
  <done>SupplementaryDetailCard shows step count and warning count badges when data is available, and displays "Installation Guide" label instead of generic "Supplementary" relationship type. Card continues to link to /fixer/ detail pages.</done>
</task>

</tasks>

<verification>
1. `npm run build` passes with zero errors
2. `grep -rn '"/cop/' components/details/` returns zero matches (no old /cop/ links remain)
3. `grep -rn 'encyclopedia/cop' components/details/` returns matches in both DetailViewer and CopSectionLinks
4. SupplementaryDetailCard.tsx imports and renders step/warning badges conditionally
</verification>

<success_criteria>
- Every COP section link from Installation Guide detail pages navigates to /encyclopedia/cop/ routes
- SupplementaryDetailCard shows enhanced preview with practical content indicators (step count, warning count, 3D model availability)
- Bidirectional navigation maintained: COP articles link to /fixer/ details, detail pages link to /encyclopedia/cop/ articles
- Application builds successfully with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/34-installation-guide-transformation/34-02-SUMMARY.md`
</output>
