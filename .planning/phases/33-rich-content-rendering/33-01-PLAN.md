---
phase: 33-rich-content-rendering
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tailwind.config.ts
  - components/cop/CopImage.tsx
  - components/encyclopedia/ArticleContent.tsx
autonomous: true

must_haves:
  truths:
    - "Technical diagrams render inline within article sections at point of reference with click-to-zoom capability"
    - "Image captions display figure numbers matching COP section context for citation"
    - "Tailwind typography plugin configured with legislative-quality prose overrides for formal document styling"
  artifacts:
    - path: "tailwind.config.ts"
      provides: "Custom prose overrides for legislative typography"
      contains: "typography"
    - path: "components/cop/CopImage.tsx"
      provides: "Enhanced image rendering with zoom dialog and figure numbering"
      min_lines: 50
    - path: "components/encyclopedia/ArticleContent.tsx"
      provides: "Images positioned within section flow before supplementary content"
      min_lines: 100
  key_links:
    - from: "tailwind.config.ts"
      to: "components/encyclopedia/ArticleContent.tsx"
      via: "prose class overrides applied to article content div"
      pattern: "prose"
    - from: "components/cop/CopImage.tsx"
      to: "components/encyclopedia/ArticleContent.tsx"
      via: "CopImage rendered within each section's content flow"
      pattern: "CopImage"
---

<objective>
Enhance the Tailwind typography plugin configuration for legislative-quality prose styling and improve technical diagram presentation with click-to-zoom capability and figure numbering.

Purpose: The typography plugin is installed but uncustomised — prose needs formal document overrides (tighter heading spacing, serif-inspired weight hierarchy, subtle table borders, wider paragraph spacing). CopImage works but lacks zoom-on-click for technical diagrams where detail matters, and has no figure numbering for COP citation context.

Output: Custom typography config in tailwind.config.ts, enhanced CopImage component with Dialog-based zoom, updated ArticleContent with improved image positioning.
</objective>

<execution_context>
@C:/Users/LukeBoustridge/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/LukeBoustridge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@tailwind.config.ts
@components/cop/CopImage.tsx
@components/encyclopedia/ArticleContent.tsx
@components/encyclopedia/CrossLinkedText.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Tailwind typography plugin with legislative prose overrides</name>
  <files>tailwind.config.ts</files>
  <action>
Add typography customisation to the Tailwind config `theme.extend` section. The `@tailwindcss/typography` plugin is already in the plugins array. Add a `typography` key with custom prose overrides for legislative document styling:

```ts
typography: {
  DEFAULT: {
    css: {
      // Legislative heading hierarchy: tighter spacing, formal weight
      'h2': {
        fontWeight: '700',
        marginTop: '2em',
        marginBottom: '0.75em',
        borderBottom: '1px solid rgb(226 232 240)', // slate-200
        paddingBottom: '0.5em',
      },
      'h3': {
        fontWeight: '600',
        marginTop: '1.75em',
        marginBottom: '0.5em',
      },
      'h4, h5, h6': {
        fontWeight: '600',
        marginTop: '1.5em',
        marginBottom: '0.5em',
      },
      // Wider paragraph spacing for formal readability
      'p': {
        marginTop: '1em',
        marginBottom: '1em',
        lineHeight: '1.75',
      },
      // Tables with subtle borders for specification tables
      'table': {
        borderCollapse: 'collapse',
        width: '100%',
      },
      'th': {
        backgroundColor: 'rgb(248 250 252)', // slate-50
        fontWeight: '600',
        padding: '0.75em 1em',
        borderBottom: '2px solid rgb(226 232 240)',
        textAlign: 'left',
      },
      'td': {
        padding: '0.75em 1em',
        borderBottom: '1px solid rgb(241 245 249)', // slate-100
      },
      // Lists with formal spacing
      'ul, ol': {
        paddingLeft: '1.5em',
      },
      'li': {
        marginTop: '0.375em',
        marginBottom: '0.375em',
      },
      // Figure captions
      'figcaption': {
        fontStyle: 'normal',
        fontSize: '0.875em',
        color: 'rgb(100 116 139)', // slate-500
        textAlign: 'center',
        marginTop: '0.5em',
      },
      // Blockquotes for legislative references
      'blockquote': {
        borderLeftColor: 'rgb(148 163 184)', // slate-400
        borderLeftWidth: '3px',
        fontStyle: 'normal',
        color: 'rgb(71 85 105)', // slate-600
        paddingLeft: '1.25em',
      },
      // Max image width within prose
      'img': {
        marginTop: '1.5em',
        marginBottom: '1.5em',
        borderRadius: '0.5rem',
      },
    },
  },
  // Slate variant overrides (matches prose-slate)
  slate: {
    css: {
      '--tw-prose-body': 'rgb(51 65 85)',     // slate-700
      '--tw-prose-headings': 'rgb(15 23 42)', // slate-900
      '--tw-prose-links': 'hsl(var(--primary))',
      '--tw-prose-bold': 'rgb(30 41 59)',     // slate-800
      '--tw-prose-counters': 'rgb(100 116 139)', // slate-500
      '--tw-prose-bullets': 'rgb(148 163 184)',   // slate-400
      '--tw-prose-hr': 'rgb(226 232 240)',        // slate-200
      '--tw-prose-quotes': 'rgb(71 85 105)',      // slate-600
      '--tw-prose-quote-borders': 'rgb(148 163 184)', // slate-400
      '--tw-prose-th-borders': 'rgb(226 232 240)',     // slate-200
      '--tw-prose-td-borders': 'rgb(241 245 249)',     // slate-100
    },
  },
},
```

This creates a formal, high-readability document style matching legislative document conventions: clear heading hierarchy with bottom borders on h2, wide paragraph spacing (1.75 line-height), formal table styling, and consistent colour variables for the slate variant.
  </action>
  <verify>Run `npm run build` — build should succeed with no errors. Visually, prose-slate classes will now pick up the custom overrides on encyclopedia pages.</verify>
  <done>tailwind.config.ts has a `typography` key in `theme.extend` with DEFAULT and slate prose overrides for legislative styling. Build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Enhance CopImage with click-to-zoom Dialog and figure numbering</name>
  <files>components/cop/CopImage.tsx, components/encyclopedia/ArticleContent.tsx</files>
  <action>
**CopImage.tsx** — Transform into a client component with zoom capability:

1. Add `'use client'` directive at top
2. Import Dialog, DialogContent, DialogTrigger from `@/components/ui/dialog` (shadcn already installed)
3. Import `ZoomIn` icon from lucide-react
4. Add optional `figureIndex` prop (number) for figure numbering within a section
5. Wrap the existing Image in a Dialog trigger that opens a full-size view:
   - The thumbnail renders as before (rounded, border, responsive sizes)
   - Add a subtle zoom indicator on hover (ZoomIn icon, opacity-0 group-hover:opacity-100)
   - Dialog content shows the image at full resolution with `object-contain` and max viewport dimensions
   - Caption text in the Dialog shows full caption without truncation
6. Figure caption format: if `figureIndex` is provided, prefix caption with "Figure {figureIndex}: " for COP citation context
7. Keep the component backward-compatible — the existing /cop/ reader uses CopImage without figureIndex and should continue working identically

The Dialog-based zoom pattern is lightweight (shadcn Dialog is already available) and avoids adding any new dependencies.

**ArticleContent.tsx** — Pass `figureIndex` to CopImage:

In the images rendering block (lines 63-74), pass `figureIndex={idx + 1}` to each CopImage so diagrams get numbered within their section:

```tsx
<CopImage
  key={`${section.number}-img-${idx}`}
  image={image}
  chapterNumber={chapterNumber}
  sectionNumber={section.number}
  figureIndex={idx + 1}
/>
```

This is a minimal change — just adding one prop.
  </action>
  <verify>Run `npm run build` — build should succeed. CopImage component should export a client component with Dialog zoom. ArticleContent should pass figureIndex prop to CopImage.</verify>
  <done>CopImage renders with click-to-zoom Dialog overlay showing full-resolution image. Figure numbering displays in captions. ArticleContent passes figureIndex to CopImage for numbered figures. Build passes. Existing /cop/ reader unaffected (figureIndex is optional).</done>
</task>

</tasks>

<verification>
1. `npm run build` passes with zero errors
2. tailwind.config.ts contains `typography` key with DEFAULT and slate overrides
3. CopImage.tsx is a client component with Dialog import and zoom behavior
4. ArticleContent.tsx passes figureIndex to CopImage
5. No regressions on existing /cop/ reader pages (CopImage backward compatible)
</verification>

<success_criteria>
- Tailwind typography plugin configured with legislative-quality prose overrides (heading hierarchy, table borders, paragraph spacing)
- CopImage has click-to-zoom Dialog for viewing technical diagram detail
- Figure numbering in image captions for COP citation context
- Build passes, no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/33-rich-content-rendering/33-01-SUMMARY.md`
</output>
