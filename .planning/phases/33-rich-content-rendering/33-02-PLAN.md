---
phase: 33-rich-content-rendering
plan: 02
type: execute
wave: 2
depends_on: [33-01]
files_modified:
  - components/encyclopedia/InlineCaseLawCallout.tsx
  - components/encyclopedia/ArticleContent.tsx
autonomous: true

must_haves:
  truths:
    - "Case law callouts render as margin notes floated right on desktop (lg+) screens"
    - "Case law callouts render as full-width inline blocks on mobile/tablet screens"
    - "Case law margin notes sit alongside the article prose without breaking the reading flow"
  artifacts:
    - path: "components/encyclopedia/InlineCaseLawCallout.tsx"
      provides: "Margin-note-style case law callout with float-right desktop layout"
      min_lines: 60
    - path: "components/encyclopedia/ArticleContent.tsx"
      provides: "Case law rendered with margin-note wrapper for float layout"
      min_lines: 100
  key_links:
    - from: "components/encyclopedia/InlineCaseLawCallout.tsx"
      to: "components/encyclopedia/ArticleContent.tsx"
      via: "InlineCaseLawCallout imported and rendered within section supplementary content"
      pattern: "InlineCaseLawCallout"
---

<objective>
Transform InlineCaseLawCallout from a full-width block into a margin-note-style annotation that floats alongside article prose on desktop, matching the legislative annotation pattern used on legislation.govt.nz.

Purpose: The success criteria requires "case law appears as inline callout annotations within article content in margin-note style." Currently, InlineCaseLawCallout renders as a full-width block that interrupts the reading flow. Margin-note style means the callout floats to the right on desktop (like a sidenote in printed legislation), allowing the main prose to flow alongside it. On mobile, it reverts to full-width for readability.

Output: Updated InlineCaseLawCallout with margin-note dimensions, updated ArticleContent with float wrapper for case law.
</objective>

<execution_context>
@C:/Users/LukeBoustridge/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/LukeBoustridge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@components/encyclopedia/InlineCaseLawCallout.tsx
@components/encyclopedia/ArticleContent.tsx
@types/encyclopedia.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Transform InlineCaseLawCallout to margin-note styling</name>
  <files>components/encyclopedia/InlineCaseLawCallout.tsx</files>
  <action>
Update InlineCaseLawCallout to use margin-note dimensions that work within a float container:

1. **Outer container**: Change the root div classes from full-width block to compact margin-note dimensions:
   - Keep: `rounded-lg border-l-4 border-amber-400 bg-amber-50/50 p-4 mt-4 mb-2`
   - These dimensions are set by the WRAPPER in ArticleContent (Task 2), not here. The component itself should be compact and work at any width.

2. **Reduce internal padding** from `p-4` to `p-3` for tighter margin-note fit

3. **Tighten text**:
   - Case type label: keep `text-xs` but reduce `mb-2` to `mb-1.5`
   - Case ID: change from `text-sm` to `text-xs` and `mb-2` to `mb-1.5`
   - Summary: keep `text-sm line-clamp-3` but change to `line-clamp-4` (slightly more content in the narrow column)
   - Failure type: keep as-is
   - PDF link: keep as-is

4. **Add visual margin-note indicator**: Add a small "annotation" visual cue — a thin top border in amber-200 or a subtle gavel/scale icon from lucide-react (use `Scale` icon, h-3 w-3, positioned next to the case type label).

The component itself doesn't need to know about floating — the float/responsive behavior is controlled by the wrapper div in ArticleContent.
  </action>
  <verify>Run `npm run build` — component should compile with no errors. The component should be slightly more compact than before (tighter padding and spacing).</verify>
  <done>InlineCaseLawCallout has tighter spacing suitable for margin-note rendering. A Scale icon provides visual annotation cue. Build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Add margin-note float wrapper in ArticleContent for case law</name>
  <files>components/encyclopedia/ArticleContent.tsx</files>
  <action>
Update the case law rendering in ArticleContent to wrap InlineCaseLawCallout in a float container that creates margin-note behavior:

In the supplementary content rendering section (around line 92-97), wrap the case law map with a float container:

**Replace the case law rendering block:**
```tsx
{/* 2. Case Law callouts (amber, inline content) */}
{supplements.caseLaw && supplements.caseLaw.length > 0 &&
  supplements.caseLaw.map(caseLaw => (
    <InlineCaseLawCallout key={caseLaw.id} caseLaw={caseLaw} />
  ))
}
```

**With margin-note wrapper:**
```tsx
{/* 2. Case Law margin-note annotations (float right on desktop, full-width on mobile) */}
{supplements.caseLaw && supplements.caseLaw.length > 0 &&
  supplements.caseLaw.map(caseLaw => (
    <div
      key={caseLaw.id}
      className="lg:float-right lg:ml-6 lg:mb-4 lg:w-72 xl:w-80 lg:-mr-4"
    >
      <InlineCaseLawCallout caseLaw={caseLaw} />
    </div>
  ))
}
```

**Responsive behavior explained:**
- **Mobile/tablet (< lg)**: No float, renders as full-width block (same as current behavior)
- **Desktop (lg)**: `float-right` pulls the callout to the right side, `ml-6` creates gutter between prose and callout, `w-72` (xl: `w-80`) constrains width for margin-note appearance, `-mr-4` extends slightly into the right margin for a true margin-note feel
- `mb-4` adds spacing below the floated element

**Add clearfix after supplementary content block:**

After the closing `</>` of the supplementary content IIFE (around line 130), add a clearfix div to prevent float bleed into subsections:

```tsx
{/* Clear any floated margin notes before subsections */}
<div className="clear-both" />
```

This goes BEFORE the recursive subsections block. Place it after the supplementary content IIFE closing `})()}` and before `{/* Recursive subsections */}`.
  </action>
  <verify>Run `npm run build` — build passes. ArticleContent should have `lg:float-right` wrapper around InlineCaseLawCallout and a `clear-both` div before subsections.</verify>
  <done>Case law callouts float right as margin notes on desktop (lg+). Full-width on mobile/tablet. Clearfix prevents float bleed into subsections. Build passes.</done>
</task>

</tasks>

<verification>
1. `npm run build` passes with zero errors
2. InlineCaseLawCallout has tighter spacing with Scale icon annotation cue
3. ArticleContent wraps case law in `lg:float-right lg:w-72` container
4. Clearfix div present before recursive subsections
5. No regressions on mobile rendering (no float classes at < lg breakpoint)
</verification>

<success_criteria>
- Case law renders as margin-note float-right annotations on desktop screens
- Case law renders as full-width blocks on mobile/tablet screens
- Main article prose flows alongside case law margin notes without layout breakage
- Clearfix prevents float bleed into recursive subsections
- Build passes, no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/33-rich-content-rendering/33-02-SUMMARY.md`
</output>
